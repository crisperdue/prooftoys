<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
 "http://www.w3.org/TR/html4/loose.dtd">
<!-- Uses "almost standards mode", all but some table cell sizing. -->
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Proof Builder Tests</title>

  <script src="http://yui.yahooapis.com/3.3.0/build/yui/yui-min.js"></script>
  <link id=styles type="text/css" rel="stylesheet" href="logic.css">
  <script src="proofdisplay.js"></script>
  <script src="expr.js"></script>
  <script src="proof.js"></script>
  <script src="q0.js"></script>

<style type="text/css">

   h1 { color: black }
   body { xbackground-color: #EEF }

</style>
  
</head>
<body style="margin-left: .5em; text-align: left; font-family: sans-serif">

<h1>Test Results</h1>

<div id=log class="yui3-skin-sam">
</div>


<script>
YUI({filter: null, insertBefore: 'styles'})
   .use('node', 'event', 'json', 'expr', 'q0', 'test', 'console', 'proof',
        function(Y) {

  // Initialize the console
  var yconsole = new Y.Console({
      style: 'block',
      height: '600px',
      width: '700px',
      newestOnTop: false                   
    });
  yconsole.render('#log');

  // Make "Y" available globally.
  window.Y = Y;

  function assertEqual(a, b) {
    Y.Assert.areEqual(a, b);
  }

  // Set up some useful constants and functions.

  Y.Expr.utils.import();

  // Example equation: x + x = 2 * x
  var times2 = call('=', call('+', x, x), call('*', '2', x));

  // Example WFF: x > 0 --> x + x > x
  var bigger = call('-->', call('>', x, '0'),
                    call('>', call('+', x, x), x));

  var testCase = new Y.Test.Case({

      testTrue: function() {
        Y.Assert.areEqual(true, true);
      },
      test11: function() {
        Y.Assert.areEqual(1, 1);
      },
      testTrue1: function() {
        Y.Assert.areEqual(true, 1);
      },

      testVar: function() {
        assertEqual('x', x.toString());
      },

      testApp: function() {
        var app = call(f, x);
        assertEqual(f, app.fn);
        assertEqual(x, app.arg);
        assertEqual('(f x)', app.toString());
      },

      testLambda: function() {
        var abs = lambda(x, f);
        assertEqual(x, abs.bound);
        assertEqual(f, abs.body);
        assertEqual('{x : f}', abs.toString());

        assertEqual('{x : (f x)}', lambda(x, call(f, x)));
      },

      testFreeNames: function() {
        var wff = lambda(x, call(f, x));
        var map = wff.freeNames();
        var fVar = map['f'];
        Y.Assert.isInstanceOf(Y.Var, fVar);
        assertEqual('f',fVar.name);
        assertEqual(undefined, map['x']);
      },

      testSubFree: function() {
        var v = _var('v');
        var target = call(lambda(v, v), x);
        // Now substitute in 'a different v':
        var result = Y.subFree(_var('v'), x, target);
        // We see that it replaces just the free occurrence, and renames
        // the bound occurrence.
        assertEqual('({v_1 : v_1} v)', result.toString());
      },

      testSame: function() {
        var y = _var('y');
        var e1 = call(lambda(x, call(f, x)), y);
        var x2 = _var('x2');
        var e2 = call(lambda(x2, call(f, x2)), y);
        Y.Assert.isTrue(e1.same(e2));
        var e3 = call(lambda(x2, call(f, x2)), _var('y2'));
        Y.Assert.isFalse(e1.same(e3));
      },

      testNormalize: function() {
        var e1 = call(lambda(x, call(f, x)), _var('y'));
        var result = Y.normalized(e1);
        assertEqual('({$1 : (f $1)} y)', result.toString());
      },

      testIsCall2: function() {
        Y.Assert.isTrue(times2.isCall2('='), 'Times2 not an equation?');
      },

      testReplace: function() {
        var y = _var('y');
        var e1 = call(lambda(x, call(f, x)), y);
	var path = Y.path('/fn/body/arg');
        var result = e1.replace(path, function(expr) { return call(f, x); });
	assertEqual('({x : (f (f x))} y)', result.toString());
      },

      testPath: function() {
        var p = '/a/b';
        var path = Y.path(p);
        assertEqual(p, path.toString());
        assertEqual('a', path.segment);
        assertEqual('b', path.rest('a').segment);
        Y.assert(path.rest('a').rest('b').isMatch());
        assertEqual('(none)', path.rest('b').toString());
        Y.assert(Y.path('/').isMatch());
        assertEqual('f', Y.path('fn').next(call(f, x)).toString());
        assertEqual('x', Y.path('arg').next(call(f, x)).toString());
        var p2 = '/left/binop';
        assertEqual('/fn/arg/fn/fn', Y.path(p2).toString());
      },

      testSearch: function() {
        xPlusX = call('+', x, x)
        var found =
          times2.search(function(expr) { return xPlusX.matches(expr); });
        assertEqual('((+ x) x)', found.toString());
      },

      testRuleR: function() {
        var path = Y.path('/right/left');
        var withTimes = Y.rules.r(bigger, path, times2);
        assertEqual('((--> ((> x) 0)) ((> ((* 2) x)) x))', withTimes.toString());
      },

      testA4: function() {
        var y = _var('y');
        var app = call(lambda(x, call(f, x)), y);
        var result = Y.rules.a4(app);
        Y.Assert.isInstanceOf(Y.Call, result);
        assertEqual('=', result.fn.fn.name);
        assertEqual('((= ({x : (f x)} y)) (f y))', result.toString());
      },

      testAxioms: function() {
        var rules = Y.rules;
        Y.log(rules.a1().toString());
        Y.log(rules.a2().toString());
        Y.log(rules.a3().toString());
        Y.log(rules.a5().toString());
      },

      testR5200: function() {
        var result = Y.rules.r5200(call(f, y));
        assertEqual('((= (f y)) (f y))', result);
        assertEqual('((= x) x)', Y.rules.r5200(x));
      },

      testR5201a: function() {
        assertEqual('(q x)',
                    Y.rules.r5201a(call(p, x),
                                   call('=', call(p, x), call(q, x))));
      },

      testR5201b: function() {
        var result = Y.rules.r5201b(call('=', p, q));
        assertEqual('((= q) p)', result.toString());
      },

      testR5201c: function() {
        var result = Y.rules.r5201c(call('=', p, q), call('=', q, r));
        assertEqual('((= p) r)', result.toString());
      },

      testR5201d: function() {
        var result = Y.rules.r5201d(call('=', p, q), call('=', 'a', 'b'));
        assertEqual('((= (p a)) (q b))', result.toString());
      },

      testR5201e: function() {
        var result = Y.rules.r5201e(call('=', p, q), r);
        assertEqual('((= (p r)) (q r))', result.toString());
      },

      testR5201f: function() {
        var result = Y.rules.r5201f(call('=', q, r), p);
        assertEqual('((= (p q)) (p r))', result);
      }
  });


  Y.Test.Runner.add(testCase);
  Y.Test.Runner.run();
  Y.Test.Runner.subscribe(Y.Test.Runner.COMPLETE_EVENT, function(event) {
      // Y.log(Y.Test.Runner.getResults(Y.Test.Format.TAP));
      console.log(Y.Test.Runner.getResults(Y.Test.Format.TAP));
      document.body.style.backgroundColor = 
        (event.results.failed == 0 && event.results.passed > 0)
        ? '#0D0'
        : '#F00';
    });
});

</script>
</body>
</html>
